(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6510,65],{2584:(e,n,t)=>{"use strict";t.r(n),t.d(n,{assets:()=>h,contentTitle:()=>d,default:()=>u,frontMatter:()=>l,metadata:()=>m,toc:()=>p});var s=t(74848),o=t(28453),a=t(64428),i=t(78847),r=t(55246),c=t.n(r);const l={hide_table_of_contents:!0},d="Convex Chat Memory",m={id:"integrations/chat_memory/convex",title:"Convex Chat Memory",description:"For longer-term persistence across chat sessions, you can swap out the default in-memory chatHistory that backs chat memory classes like BufferMemory for Convex.",source:"@site/docs/integrations/chat_memory/convex.mdx",sourceDirName:"integrations/chat_memory",slug:"/integrations/chat_memory/convex",permalink:"/docs/integrations/chat_memory/convex",draft:!1,unlisted:!1,editUrl:"https://langchainjs-kr.site/docs/integrations/chat_memory/convex.mdx",tags:[],version:"current",frontMatter:{hide_table_of_contents:!0}},h={},p=[{value:"Setup",id:"setup",level:2},{value:"Create project",id:"create-project",level:3},{value:"Add database accessors",id:"add-database-accessors",level:3},{value:"Configure your schema",id:"configure-your-schema",level:3},{value:"Usage",id:"usage",level:2},...i.toc];function g(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"convex-chat-memory",children:"Convex Chat Memory"}),"\n",(0,s.jsxs)(n.p,{children:["For longer-term persistence across chat sessions, you can swap out the default in-memory ",(0,s.jsx)(n.code,{children:"chatHistory"})," that backs chat memory classes like ",(0,s.jsx)(n.code,{children:"BufferMemory"})," for ",(0,s.jsx)(n.a,{href:"https://convex.dev/",children:"Convex"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,s.jsx)(n.h3,{id:"create-project",children:"Create project"}),"\n",(0,s.jsxs)(n.p,{children:["Get a working ",(0,s.jsx)(n.a,{href:"https://docs.convex.dev/",children:"Convex"})," project set up, for example by using:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm create convex@latest\n"})}),"\n",(0,s.jsx)(n.h3,{id:"add-database-accessors",children:"Add database accessors"}),"\n",(0,s.jsxs)(n.p,{children:["Add query and mutation helpers to ",(0,s.jsx)(n.code,{children:"convex/langchain/db.ts"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="convex/langchain/db.ts"',children:'export * from "langchain/util/convex";\n'})}),"\n",(0,s.jsx)(n.h3,{id:"configure-your-schema",children:"Configure your schema"}),"\n",(0,s.jsx)(n.p,{children:"Set up your schema (for indexing):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="convex/schema.ts"',children:'import { defineSchema, defineTable } from "convex/server";\nimport { v } from "convex/values";\n\nexport default defineSchema({\n  messages: defineTable({\n    sessionId: v.string(),\n    message: v.object({\n      type: v.string(),\n      data: v.object({\n        content: v.string(),\n        role: v.optional(v.string()),\n        name: v.optional(v.string()),\n        additional_kwargs: v.optional(v.any()),\n      }),\n    }),\n  }).index("bySessionId", ["sessionId"]),\n});\n'})}),"\n",(0,s.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,s.jsx)(n.p,{children:"Each chat history session stored in Convex must have a unique session id."}),"\n","\n",(0,s.jsx)(i.default,{}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:"npm2yarn",children:"npm install @langchain/openai @langchain/community\n"})}),"\n","\n",(0,s.jsx)(a.A,{language:"typescript",title:"convex/myActions.ts",children:c()})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(g,{...e})}):g(e)}},78847:(e,n,t)=>{"use strict";t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>m,frontMatter:()=>a,metadata:()=>r,toc:()=>l});var s=t(74848),o=t(28453);const a={},i=void 0,r={id:"mdx_components/integration_install_tooltip",title:"integration_install_tooltip",description:"See this section for general instructions on installing integration packages.",source:"@site/docs/mdx_components/integration_install_tooltip.mdx",sourceDirName:"mdx_components",slug:"/mdx_components/integration_install_tooltip",permalink:"/docs/mdx_components/integration_install_tooltip",draft:!1,unlisted:!1,editUrl:"https://langchainjs-kr.site/docs/mdx_components/integration_install_tooltip.mdx",tags:[],version:"current",frontMatter:{}},c={},l=[];function d(e){const n={a:"a",admonition:"admonition",p:"p",...(0,o.R)(),...e.components};return(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["See ",(0,s.jsx)(n.a,{href:"/docs/how_to/installation#installing-integration-packages",children:"this section for general instructions on installing integration packages"}),"."]})})}function m(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},55246:e=>{e.exports={content:'"use node";\n\nimport { v } from "convex/values";\nimport { BufferMemory } from "langchain/memory/index";\nimport { ChatOpenAI } from "@langchain/openai";\nimport { ConversationChain } from "langchain/chains";\nimport { ConvexChatMessageHistory } from "@langchain/community/stores/message/convex";\nimport { action } from "./_generated/server.js";\n\nexport const ask = action({\n  args: { sessionId: v.string() },\n  handler: async (ctx, args) => {\n    // pass in a sessionId string\n    const { sessionId } = args;\n\n    const memory = new BufferMemory({\n      chatHistory: new ConvexChatMessageHistory({ sessionId, ctx }),\n    });\n\n    const model = new ChatOpenAI({\n      model: "gpt-3.5-turbo",\n      temperature: 0,\n    });\n\n    const chain = new ConversationChain({ llm: model, memory });\n\n    const res1 = await chain.invoke({ input: "Hi! I\'m Jim." });\n    console.log({ res1 });\n    /*\n      {\n        res1: {\n          text: "Hello Jim! It\'s nice to meet you. My name is AI. How may I assist you today?"\n        }\n      }\n    */\n\n    const res2 = await chain.invoke({\n      input: "What did I just say my name was?",\n    });\n    console.log({ res2 });\n\n    /*\n      {\n        res2: {\n          text: "You said your name was Jim."\n        }\n      }\n    */\n\n    // See the chat history in the Convex database\n    console.log(await memory.chatHistory.getMessages());\n\n    // clear chat history\n    await memory.chatHistory.clear();\n  },\n});\n',imports:[{local:"BufferMemory",imported:"BufferMemory",source:"langchain/memory/index"},{local:"ChatOpenAI",imported:"ChatOpenAI",source:"@langchain/openai"},{local:"ConversationChain",imported:"ConversationChain",source:"langchain/chains"},{local:"ConvexChatMessageHistory",imported:"ConvexChatMessageHistory",source:"@langchain/community/stores/message/convex"}]}}}]);