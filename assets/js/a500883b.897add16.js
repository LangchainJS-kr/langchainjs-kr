"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6698],{43460:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>u,contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>c,toc:()=>d});var a=t(74848),r=t(28453),s=t(78847),o=t(27846);const i={keywords:["RunnableBinding","LCEL"],title:"How to attach runtime arguments to a Runnable",sidebar_class_name:"hidden"},l=void 0,c={id:"how_to/binding",title:"How to attach runtime arguments to a Runnable",description:"This guide assumes familiarity with the following concepts:",source:"@site/docs/how_to/binding.mdx",sourceDirName:"how_to",slug:"/how_to/binding",permalink:"/docs/how_to/binding",draft:!1,unlisted:!1,editUrl:"https://langchainjs-kr.site/docs/how_to/binding.mdx",tags:[],version:"current",frontMatter:{keywords:["RunnableBinding","LCEL"],title:"How to attach runtime arguments to a Runnable",sidebar_class_name:"hidden"},sidebar:"tutorialSidebar",previous:{title:"How to add values to a chain's state",permalink:"/docs/how_to/assign"},next:{title:"How to cache embedding results",permalink:"/docs/how_to/caching_embeddings"}},u={},d=[{value:"Binding stop sequences",id:"binding-stop-sequences",level:2},...s.toc,{value:"Attaching OpenAI tools",id:"attaching-openai-tools",level:2},{value:"Next steps",id:"next-steps",level:2}];function h(n){const e={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(e.admonition,{title:"Prerequisites",type:"info",children:[(0,a.jsx)(e.p,{children:"This guide assumes familiarity with the following concepts:"}),(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.a,{href:"../../docs/concepts/#langchain-expression-language",children:"LangChain Expression Language\n(LCEL)"})}),"\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.a,{href:"../../docs/how_to/sequence/",children:"Chaining runnables"})}),"\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.a,{href:"../../docs/how_to/tool_calling/",children:"Tool calling"})}),"\n"]})]}),"\n",(0,a.jsxs)(e.p,{children:["Sometimes we want to invoke a\n",(0,a.jsx)(e.a,{href:"https://v02.api.js.langchain.com/classes/langchain_core_runnables.Runnable.html",children:(0,a.jsx)(e.code,{children:"Runnable"})}),"\nwithin a\n",(0,a.jsx)(e.a,{href:"https://v02.api.js.langchain.com/classes/langchain_core_runnables.RunnableSequence.html",children:"RunnableSequence"}),"\nwith constant arguments that are not part of the output of the preceding\nRunnable in the sequence, and which are not part of the user input. We\ncan use the\n",(0,a.jsx)(e.a,{href:"https://v02.api.js.langchain.com/classes/langchain_core_runnables.Runnable.html#bind",children:(0,a.jsx)(e.code,{children:"Runnable.bind()"})}),"\nmethod to set these arguments ahead of time."]}),"\n",(0,a.jsx)(e.h2,{id:"binding-stop-sequences",children:"Binding stop sequences"}),"\n",(0,a.jsx)(e.p,{children:"Suppose we have a simple prompt + model chain:"}),"\n","\n",(0,a.jsx)(s.default,{}),"\n",(0,a.jsx)(o.A,{children:(0,a.jsx)(e.p,{children:"@langchain/openai"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-typescript",children:'import { StringOutputParser } from "@langchain/core/output_parsers";\nimport { ChatPromptTemplate } from "@langchain/core/prompts";\nimport { ChatOpenAI } from "@langchain/openai";\n\nconst prompt = ChatPromptTemplate.fromMessages([\n  [\n    "system",\n    "Write out the following equation using algebraic symbols then solve it. Use the format\\n\\nEQUATION:...\\nSOLUTION:...\\n\\n",\n  ],\n  ["human", "{equation_statement}"],\n]);\n\nconst model = new ChatOpenAI({ temperature: 0 });\n\nconst runnable = prompt.pipe(model).pipe(new StringOutputParser());\n\nconst res = await runnable.invoke({\n  equation_statement: "x raised to the third plus seven equals 12",\n});\n\nconsole.log(res);\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-text",children:"EQUATION: x^3 + 7 = 12\n\nSOLUTION:\nSubtract 7 from both sides:\nx^3 = 5\n\nTake the cube root of both sides:\nx = \u221b5\n"})}),"\n",(0,a.jsxs)(e.p,{children:["and want to call the model with certain ",(0,a.jsx)(e.code,{children:"stop"})," words so that we shorten\nthe output, which is useful in certain types of prompting techniques.\nWhile we can pass some arguments into the constructor, other runtime\nargs use the ",(0,a.jsx)(e.code,{children:".bind()"})," method as follows:"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-typescript",children:'const runnable = prompt\n  .pipe(model.bind({ stop: "SOLUTION" }))\n  .pipe(new StringOutputParser());\n\nconst res = await runnable.invoke({\n  equation_statement: "x raised to the third plus seven equals 12",\n});\n\nconsole.log(res);\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-text",children:"EQUATION: x^3 + 7 = 12\n\n"})}),"\n",(0,a.jsx)(e.p,{children:"What you can bind to a Runnable will depend on the extra parameters you\ncan pass when invoking it."}),"\n",(0,a.jsx)(e.h2,{id:"attaching-openai-tools",children:"Attaching OpenAI tools"}),"\n",(0,a.jsxs)(e.p,{children:["Another common use-case is tool calling. While you should generally use\nthe ",(0,a.jsx)(e.a,{href:"../../docs/how_to/tool_calling/",children:(0,a.jsx)(e.code,{children:".bind_tools()"})})," method for\ntool-calling models, you can also bind provider-specific args directly\nif you want lower level control:"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-typescript",children:'const tools = [\n  {\n    type: "function",\n    function: {\n      name: "get_current_weather",\n      description: "Get the current weather in a given location",\n      parameters: {\n        type: "object",\n        properties: {\n          location: {\n            type: "string",\n            description: "The city and state, e.g. San Francisco, CA",\n          },\n          unit: { type: "string", enum: ["celsius", "fahrenheit"] },\n        },\n        required: ["location"],\n      },\n    },\n  },\n];\n\nconst model = new ChatOpenAI({ model: "gpt-4o" }).bind({ tools });\n\nawait model.invoke("What\'s the weather in SF, NYC and LA?");\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-text",children:'AIMessage {\n  lc_serializable: true,\n  lc_kwargs: {\n    content: "",\n    tool_calls: [\n      {\n        name: "get_current_weather",\n        args: { location: "San Francisco, CA" },\n        id: "call_iDKz4zU8PKBaaIT052fJkMMF"\n      },\n      {\n        name: "get_current_weather",\n        args: { location: "New York, NY" },\n        id: "call_niQwZDOqO6OJTBiDBFG8FODc"\n      },\n      {\n        name: "get_current_weather",\n        args: { location: "Los Angeles, CA" },\n        id: "call_zLXH2cDVQy0nAVC0ViWuEP4m"\n      }\n    ],\n    invalid_tool_calls: [],\n    additional_kwargs: {\n      function_call: undefined,\n      tool_calls: [\n        {\n          id: "call_iDKz4zU8PKBaaIT052fJkMMF",\n          type: "function",\n          function: [Object]\n        },\n        {\n          id: "call_niQwZDOqO6OJTBiDBFG8FODc",\n          type: "function",\n          function: [Object]\n        },\n        {\n          id: "call_zLXH2cDVQy0nAVC0ViWuEP4m",\n          type: "function",\n          function: [Object]\n        }\n      ]\n    },\n    response_metadata: {}\n  },\n  lc_namespace: [ "langchain_core", "messages" ],\n  content: "",\n  name: undefined,\n  additional_kwargs: {\n    function_call: undefined,\n    tool_calls: [\n      {\n        id: "call_iDKz4zU8PKBaaIT052fJkMMF",\n        type: "function",\n        function: {\n          name: "get_current_weather",\n          arguments: \'{"location": "San Francisco, CA"}\'\n        }\n      },\n      {\n        id: "call_niQwZDOqO6OJTBiDBFG8FODc",\n        type: "function",\n        function: {\n          name: "get_current_weather",\n          arguments: \'{"location": "New York, NY"}\'\n        }\n      },\n      {\n        id: "call_zLXH2cDVQy0nAVC0ViWuEP4m",\n        type: "function",\n        function: {\n          name: "get_current_weather",\n          arguments: \'{"location": "Los Angeles, CA"}\'\n        }\n      }\n    ]\n  },\n  response_metadata: {\n    tokenUsage: { completionTokens: 70, promptTokens: 82, totalTokens: 152 },\n    finish_reason: "tool_calls"\n  },\n  tool_calls: [\n    {\n      name: "get_current_weather",\n      args: { location: "San Francisco, CA" },\n      id: "call_iDKz4zU8PKBaaIT052fJkMMF"\n    },\n    {\n      name: "get_current_weather",\n      args: { location: "New York, NY" },\n      id: "call_niQwZDOqO6OJTBiDBFG8FODc"\n    },\n    {\n      name: "get_current_weather",\n      args: { location: "Los Angeles, CA" },\n      id: "call_zLXH2cDVQy0nAVC0ViWuEP4m"\n    }\n  ],\n  invalid_tool_calls: []\n}\n'})}),"\n",(0,a.jsx)(e.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,a.jsx)(e.p,{children:"You now know how to bind runtime arguments to a Runnable."}),"\n",(0,a.jsxs)(e.p,{children:["Next, you might be interested in our how-to guides on ",(0,a.jsx)(e.a,{href:"../../docs/how_to/passthrough/",children:"passing data\nthrough a chain"}),"."]})]})}function p(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(h,{...n})}):h(n)}},19365:(n,e,t)=>{t.d(e,{A:()=>o});t(96540);var a=t(34164);const r={tabItem:"tabItem_Ymn6"};var s=t(74848);function o(n){let{children:e,hidden:t,className:o}=n;return(0,s.jsx)("div",{role:"tabpanel",className:(0,a.A)(r.tabItem,o),hidden:t,children:e})}},11470:(n,e,t)=>{t.d(e,{A:()=>j});var a=t(96540),r=t(34164),s=t(23104),o=t(56347),i=t(205),l=t(57485),c=t(31682),u=t(89466);function d(n){return a.Children.toArray(n).filter((n=>"\n"!==n)).map((n=>{if(!n||(0,a.isValidElement)(n)&&function(n){const{props:e}=n;return!!e&&"object"==typeof e&&"value"in e}(n))return n;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof n.type?n.type:n.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(n){const{values:e,children:t}=n;return(0,a.useMemo)((()=>{const n=e??function(n){return d(n).map((n=>{let{props:{value:e,label:t,attributes:a,default:r}}=n;return{value:e,label:t,attributes:a,default:r}}))}(t);return function(n){const e=(0,c.X)(n,((n,e)=>n.value===e.value));if(e.length>0)throw new Error(`Docusaurus error: Duplicate values "${e.map((n=>n.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(n),n}),[e,t])}function p(n){let{value:e,tabValues:t}=n;return t.some((n=>n.value===e))}function m(n){let{queryString:e=!1,groupId:t}=n;const r=(0,o.W6)(),s=function(n){let{queryString:e=!1,groupId:t}=n;if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,l.aZ)(s),(0,a.useCallback)((n=>{if(!s)return;const e=new URLSearchParams(r.location.search);e.set(s,n),r.replace({...r.location,search:e.toString()})}),[s,r])]}function g(n){const{defaultValue:e,queryString:t=!1,groupId:r}=n,s=h(n),[o,l]=(0,a.useState)((()=>function(n){let{defaultValue:e,tabValues:t}=n;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map((n=>n.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const a=t.find((n=>n.default))??t[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:e,tabValues:s}))),[c,d]=m({queryString:t,groupId:r}),[g,b]=function(n){let{groupId:e}=n;const t=function(n){return n?`docusaurus.tab.${n}`:null}(e),[r,s]=(0,u.Dv)(t);return[r,(0,a.useCallback)((n=>{t&&s.set(n)}),[t,s])]}({groupId:r}),f=(()=>{const n=c??g;return p({value:n,tabValues:s})?n:null})();(0,i.A)((()=>{f&&l(f)}),[f]);return{selectedValue:o,selectValue:(0,a.useCallback)((n=>{if(!p({value:n,tabValues:s}))throw new Error(`Can't select invalid tab value=${n}`);l(n),d(n),b(n)}),[d,b,s]),tabValues:s}}var b=t(92303);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var w=t(74848);function _(n){let{className:e,block:t,selectedValue:a,selectValue:o,tabValues:i}=n;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,s.a_)(),u=n=>{const e=n.currentTarget,t=l.indexOf(e),r=i[t].value;r!==a&&(c(e),o(r))},d=n=>{let e=null;switch(n.key){case"Enter":u(n);break;case"ArrowRight":{const t=l.indexOf(n.currentTarget)+1;e=l[t]??l[0];break}case"ArrowLeft":{const t=l.indexOf(n.currentTarget)-1;e=l[t]??l[l.length-1];break}}e?.focus()};return(0,w.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":t},e),children:i.map((n=>{let{value:e,label:t,attributes:s}=n;return(0,w.jsx)("li",{role:"tab",tabIndex:a===e?0:-1,"aria-selected":a===e,ref:n=>l.push(n),onKeyDown:d,onClick:u,...s,className:(0,r.A)("tabs__item",f.tabItem,s?.className,{"tabs__item--active":a===e}),children:t??e},e)}))})}function x(n){let{lazy:e,children:t,selectedValue:r}=n;const s=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){const n=s.find((n=>n.props.value===r));return n?(0,a.cloneElement)(n,{className:"margin-top--md"}):null}return(0,w.jsx)("div",{className:"margin-top--md",children:s.map(((n,e)=>(0,a.cloneElement)(n,{key:e,hidden:n.props.value!==r})))})}function v(n){const e=g(n);return(0,w.jsxs)("div",{className:(0,r.A)("tabs-container",f.tabList),children:[(0,w.jsx)(_,{...e,...n}),(0,w.jsx)(x,{...e,...n})]})}function j(n){const e=(0,b.A)();return(0,w.jsx)(v,{...n,children:d(n.children)},String(e))}},27846:(n,e,t)=>{t.d(e,{A:()=>i});t(96540);var a=t(11470),r=t(19365),s=t(21432),o=t(74848);function i(n){let{children:e}=n;return(0,o.jsxs)(a.A,{groupId:"npm2yarn",children:[(0,o.jsx)(r.A,{value:"npm",label:"npm",children:(0,o.jsxs)(s.A,{language:"bash",children:["npm i ",e]})}),(0,o.jsx)(r.A,{value:"yarn",label:"yarn",default:!0,children:(0,o.jsxs)(s.A,{language:"bash",children:["yarn add ",e]})}),(0,o.jsx)(r.A,{value:"pnpm",label:"pnpm",children:(0,o.jsxs)(s.A,{language:"bash",children:["pnpm add ",e]})})]})}}}]);