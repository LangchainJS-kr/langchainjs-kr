(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8953],{4712:(e,n,s)=>{"use strict";s.r(n),s.d(n,{assets:()=>g,contentTitle:()=>l,default:()=>u,frontMatter:()=>c,metadata:()=>d,toc:()=>h});var t=s(74848),r=s(28453),a=s(64428),o=s(44683),i=s.n(o);const c={},l="Vercel KV",d={id:"integrations/stores/vercel_kv_storage",title:"Vercel KV",description:"This example demonstrates how to setup chat history storage using the VercelKVStore BaseStore integration.",source:"@site/docs/integrations/stores/vercel_kv_storage.mdx",sourceDirName:"integrations/stores",slug:"/integrations/stores/vercel_kv_storage",permalink:"/docs/integrations/stores/vercel_kv_storage",draft:!1,unlisted:!1,editUrl:"https://langchainjs-kr.site/docs/integrations/stores/vercel_kv_storage.mdx",tags:[],version:"current",frontMatter:{},sidebar:"integrations",previous:{title:"Upstash Redis",permalink:"/docs/integrations/stores/upstash_redis_storage"}},g={},h=[{value:"Setup",id:"setup",level:2},{value:"Usage",id:"usage",level:2}];function m(e){const n={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"vercel-kv",children:"Vercel KV"}),"\n",(0,t.jsxs)(n.p,{children:["This example demonstrates how to setup chat history storage using the ",(0,t.jsx)(n.code,{children:"VercelKVStore"})," ",(0,t.jsx)(n.code,{children:"BaseStore"})," integration."]}),"\n",(0,t.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:"npm2yarn",children:"npm install @vercel/kv\n"})}),"\n",(0,t.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n","\n",(0,t.jsx)(a.A,{language:"typescript",children:i()})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(m,{...e})}):m(e)}},44683:e=>{e.exports={content:'import { createClient } from "@vercel/kv";\nimport { VercelKVStore } from "@langchain/community/storage/vercel_kv";\nimport { AIMessage, HumanMessage } from "@langchain/core/messages";\n\n// Pro tip: define a helper function for getting your client\n// along with handling the case where your environment variables\n// are not set.\nconst getClient = () => {\n  if (!process.env.VERCEL_KV_API_URL || !process.env.VERCEL_KV_API_TOKEN) {\n    throw new Error(\n      "VERCEL_KV_API_URL and VERCEL_KV_API_TOKEN must be set in the environment"\n    );\n  }\n  const client = createClient({\n    url: process.env.VERCEL_KV_API_URL,\n    token: process.env.VERCEL_KV_API_TOKEN,\n  });\n  return client;\n};\n\n// Define the client and store\nconst client = getClient();\nconst store = new VercelKVStore({\n  client,\n});\n// Define our encoder/decoder for converting between strings and Uint8Arrays\nconst encoder = new TextEncoder();\nconst decoder = new TextDecoder();\n/**\n * Here you would define your LLM and chat chain, call\n * the LLM and eventually get a list of messages.\n * For this example, we\'ll assume we already have a list.\n */\nconst messages = Array.from({ length: 5 }).map((_, index) => {\n  if (index % 2 === 0) {\n    return new AIMessage("ai stuff...");\n  }\n  return new HumanMessage("human stuff...");\n});\n// Set your messages in the store\n// The key will be prefixed with `message:id:` and end\n// with the index.\nawait store.mset(\n  messages.map((message, index) => [\n    `message:id:${index}`,\n    encoder.encode(JSON.stringify(message)),\n  ])\n);\n// Now you can get your messages from the store\nconst retrievedMessages = await store.mget(["message:id:0", "message:id:1"]);\n// Make sure to decode the values\nconsole.log(retrievedMessages.map((v) => decoder.decode(v)));\n/**\n[\n  \'{"id":["langchain","AIMessage"],"kwargs":{"content":"ai stuff..."}}\',\n  \'{"id":["langchain","HumanMessage"],"kwargs":{"content":"human stuff..."}}\'\n]\n */\n// Or, if you want to get back all the keys you can call\n// the `yieldKeys` method.\n// Optionally, you can pass a key prefix to only get back\n// keys which match that prefix.\nconst yieldedKeys = [];\nfor await (const key of store.yieldKeys("message:id:")) {\n  yieldedKeys.push(key);\n}\n// The keys are not encoded, so no decoding is necessary\nconsole.log(yieldedKeys);\n/**\n[\n  \'message:id:2\',\n  \'message:id:1\',\n  \'message:id:3\',\n  \'message:id:0\',\n  \'message:id:4\'\n]\n */\n// Finally, let\'s delete the keys from the store\nawait store.mdelete(yieldedKeys);\n',imports:[{local:"VercelKVStore",imported:"VercelKVStore",source:"@langchain/community/storage/vercel_kv"},{local:"AIMessage",imported:"AIMessage",source:"@langchain/core/messages"},{local:"HumanMessage",imported:"HumanMessage",source:"@langchain/core/messages"}]}}}]);